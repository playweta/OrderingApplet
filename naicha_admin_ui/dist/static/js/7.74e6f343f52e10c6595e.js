webpackJsonp([7],{"+Wdd":function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=o("mvHQ"),a=o.n(r),s=o("dca+");var i=o("DSoa"),l={name:"goodsAdminComponent",data:function(){return{searchParams:{searchParam1:null,pageNo:1,pageSize:10},goodsCategoryList:[],total:0,goodsAdmins:[],formDialogVisible:!1,formTitle:"添加",formData:{id:null,goodsCategoryName:"",name:"",displayOrder:0,defaultPrice:0,isSell:1,image:null,description:""},rules:{name:[{required:!0,message:"商品种类不能为空",trigger:"blur"}],goodsCategoryName:[{required:!0,message:"商品种类不能为空",trigger:"blur"}],displayOrder:[{required:!0,message:"显示次序不能为空",trigger:"blur"}],defaultPrice:[{required:!0,message:"默认价格不能为空",trigger:"blur"}],isSell:[{required:!0,message:"是否在卖不能为空",trigger:"blur"}],image:[{required:!0,message:"商品图片不能为空",trigger:"blur"}]},fileUploadUrl:"http://xxl.today/naicha-admin-api/goodsAdmin/image",goodsImageBaseUrl:"http://xxl.today/naicha-admin-api/static/image/",expands:[],goodsPropertyFormDialogVisible:!1,goodsPropertyFormTitle:"添加商品属性",currentGoodsId:null,goodsPropertyCategories:["大小","温度","甜度","口味","加料"],goodsPropertyFormData:{id:null,goodsId:null,category:"",propertyOption:"",isDefault:0,rebasePrice:null,extraPrice:null},goodsPropertyRules:{category:[{required:!0,message:"商品属性类型不能为空",trigger:"blur"}],propertyOption:[{required:!0,message:"商品的属性值不能为空",trigger:"blur"}]}}},mounted:function(){this.getGoodsAdmins(),this.getAllGoodsCategoryAdmins()},methods:{getAllGoodsCategoryAdmins:function(){var e=this;Object(i.c)().then(function(t){e.goodsCategoryList=t.data})},changeCategoryOfGoods:function(e){console.log("修改商品的种类: ",e)},getGoodsAdmins:function(){var e,t,o,r=this;(e=r.searchParams.pageNo,t=r.searchParams.pageSize,o="/goodsAdmin/page?pageNo=",o=(o+=e||"")+"&pageSize="+(t||""),Object(s.a)({url:o,method:"get"})).then(function(e){e.data.records.forEach(function(e){e.image&&(e.image=e.image+"?random="+Math.floor(1e4*Math.random()))}),r.goodsAdmins=e.data.records,r.total=e.data.total})},changePageNo:function(e){this.searchParams.pageNo=e,this.getGoodsAdmins()},changePageSize:function(e){this.searchParams.pageSize=e,this.getGoodsAdmins()},resetForm:function(){this.formData={id:null,goodsCategoryName:"",name:"",displayOrder:0,defaultPrice:0,isSell:1,image:null,description:""}},toAdd:function(){this.resetForm(),this.formDialogVisible=!0,this.formTitle="添加"},toDelete:function(e){var t=this,o=this;this.$confirm("提示","是否删除",{}).then(function(){var r;(r=[e],Object(s.a)({url:"/goodsAdmin/batch",method:"delete",data:r})).then(function(){t.$notify.success("删除成功"),o.getGoodsAdmins()})}).catch(function(){})},toEdit:function(e){this.formData=JSON.parse(a()(e)),this.formDialogVisible=!0,this.formTitle="更新"},handelConfirm:function(){var e=this;this.$refs.form.validate(function(t){var o;(console.log(e.formTitle),t)&&(e.formDialogVisible=!1,e.formTitle.startsWith("添加")?(o=e.formData,Object(s.a)({url:"/goodsAdmin",method:"post",data:o})).then(function(t){e.$notify.success("添加成功"),e.getGoodsAdmins()}):e.formTitle.startsWith("更新")&&function(e){return Object(s.a)({url:"/goodsAdmin",method:"put",data:e})}(e.formData).then(function(t){e.$notify.success("更新成功"),e.getGoodsAdmins()}))})},commitStatusChange:function(e,t){var o=this;this.$confirm(!1===e?"是否下架商品？":"是否上架商品？").then(function(){var r;(r=t.id,Object(s.a)({url:"/goodsAdmin/updateSellStatus/"+r,method:"put"})).then(function(){o.$notify.success(!0===e?"已上架":"已下架")}).catch(function(){t.isSell=!t.isSell})}).catch(function(){t.isSell=!t.isSell})},handleAvatarSuccess:function(){this.getGoodsAdmins()},beforeAvatarUpload:function(e){var t="image/jpeg"===e.type,o=e.size/1024/30<1;return t||this.$message.error("上传头像图片只能是 JPG 格式!"),o||this.$message.error("上传头像图片大小不能超过 30KB!"),t&&o},refreshGoods:function(){var e,t=this;(e=t.currentGoodsId,Object(s.a)({url:"/goodsAdmin/"+e,method:"get"})).then(function(e){for(var o=e.data,r=t.goodsAdmins,a=0;a<r.length;a++)if(r[a].id===o.id){t.$set(t.goodsAdmins,a,o);break}})},resetGoodsPropertyForm:function(){this.goodsPropertyFormData={id:null,goodsId:null,category:"",propertyOption:"",isDefault:0,rebasePrice:null,extraPrice:null}},toAddGoodsProperty:function(e){this.currentGoodsId=e,this.resetGoodsPropertyForm(),this.goodsPropertyFormDialogVisible=!0,this.goodsPropertyFormTitle="添加商品属性"},toEditGoodsProperty:function(e){this.currentGoodsId=e.goodsId,this.goodsPropertyFormData=JSON.parse(a()(e)),this.goodsPropertyFormDialogVisible=!0,this.goodsPropertyFormTitle="更新商品属性"},expandSelect:function(e,t){t.length?(this.expands=[],e&&this.expands.push(e.id)):this.expands=[]},handelGoodsPropertyFormConfirm:function(){var e=this,t=this;this.$refs.goodsPropertyForm.validate(function(o){var r;(console.log(e.goodsPropertyFormTitle),o)&&(t.goodsPropertyFormDialogVisible=!1,t.goodsPropertyFormTitle.startsWith("添加")?(t.goodsPropertyFormData.goodsId=t.currentGoodsId,(r=t.goodsPropertyFormData,Object(s.a)({url:"/goodsPropertyAdmin",method:"post",data:r})).then(function(e){t.$notify.success("添加成功"),t.refreshGoods()})):e.goodsPropertyFormTitle.startsWith("更新")&&function(e){return Object(s.a)({url:"/goodsPropertyAdmin",method:"put",data:e})}(e.goodsPropertyFormData).then(function(o){e.$notify.success("更新成功"),t.refreshGoods()}))})},setDefaultPropertyOfGoods:function(e,t){if(this.currentGoodsId=t.goodsId,e){var o=this;this.$confirm("是否设置为默认属性？").then(function(){var e;(e=t.id,Object(s.a)({url:"/goodsPropertyAdmin/setDefault/"+e,method:"put"})).then(function(){o.$notify.success("设置成功"),o.refreshGoods()}).catch(function(){t.isDefault=!t.isDefault})}).catch(function(){t.isDefault=!t.isDefault})}else t.isDefault=!0},deleteGoodsProperty:function(e){var t=this;this.currentGoodsId=e.goodsId;var o=this;this.$confirm("提示","是否删除该商品属性",{}).then(function(){var r;(r=e.id,Object(s.a)({url:"/goodsPropertyAdmin/"+r,method:"delete"})).then(function(){t.$notify.success("删除成功"),o.refreshGoods()})}).catch(function(){})}}},n={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",[o("div",{staticStyle:{"text-align":"left",margin:"5px 10px"}},[o("el-button",{attrs:{size:"mini",type:"primary",round:""},on:{click:e.toAdd}},[e._v("\n      添加\n    ")])],1),e._v(" "),o("el-dialog",{attrs:{title:e.formTitle,visible:e.formDialogVisible},on:{"update:visible":function(t){e.formDialogVisible=t}}},[o("el-form",{ref:"form",attrs:{model:e.formData,rules:e.rules,size:"large","label-width":"150px"}},[o("el-form-item",{attrs:{label:"商品名称",prop:"name"}},[o("el-input",{attrs:{placeholder:""},model:{value:e.formData.name,callback:function(t){e.$set(e.formData,"name",t)},expression:"formData.name"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"选择商品种类"}},[o("el-select",{staticStyle:{float:"left"},attrs:{placeholder:"选择商品种类",size:"mini"},model:{value:e.formData.goodsCategoryName,callback:function(t){e.$set(e.formData,"goodsCategoryName",t)},expression:"formData.goodsCategoryName"}},e._l(e.goodsCategoryList,function(e){return o("el-option",{key:e.name,attrs:{label:e.name,value:e.name}})}),1)],1),e._v(" "),o("el-form-item",{attrs:{label:"显示次序",prop:"displayOrder"}},[o("el-input",{attrs:{placeholder:"显示次序",type:"number"},model:{value:e.formData.displayOrder,callback:function(t){e.$set(e.formData,"displayOrder",t)},expression:"formData.displayOrder"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"默认价格(单位: 分)",prop:"defaultPrice"}},[o("el-input",{attrs:{placeholder:"默认价格",type:"number"},model:{value:e.formData.defaultPrice,callback:function(t){e.$set(e.formData,"defaultPrice",t)},expression:"formData.defaultPrice"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"商品描述",prop:"description"}},[o("el-input",{attrs:{placeholder:"商品描述, 最多100字"},model:{value:e.formData.description,callback:function(t){e.$set(e.formData,"description",t)},expression:"formData.description"}})],1),e._v(" "),o("el-form-item",[o("el-button",{on:{click:e.resetForm}},[e._v("重置")]),e._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:e.handelConfirm}},[e._v("确定")])],1)],1)],1),e._v(" "),o("el-dialog",{attrs:{title:e.goodsPropertyFormTitle,visible:e.goodsPropertyFormDialogVisible},on:{"update:visible":function(t){e.goodsPropertyFormDialogVisible=t}}},[o("el-form",{ref:"goodsPropertyForm",attrs:{model:e.goodsPropertyFormData,rules:e.goodsPropertyRules,size:"large","label-width":"180px"}},[o("el-form-item",{attrs:{label:"属性类型",prop:"category"}},[o("el-select",{staticStyle:{float:"left"},attrs:{placeholder:"选择商品种类",size:"mini"},model:{value:e.goodsPropertyFormData.category,callback:function(t){e.$set(e.goodsPropertyFormData,"category",t)},expression:"goodsPropertyFormData.category"}},e._l(e.goodsPropertyCategories,function(e){return o("el-option",{key:e,attrs:{label:e,value:e}})}),1)],1),e._v(" "),o("el-form-item",{attrs:{label:"属性值",prop:"propertyOption"}},[o("el-input",{attrs:{placeholder:"比如: 大杯，加冰，常温..."},model:{value:e.goodsPropertyFormData.propertyOption,callback:function(t){e.$set(e.goodsPropertyFormData,"propertyOption",t)},expression:"goodsPropertyFormData.propertyOption"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"商品默认价格(单位: 分)",prop:"realPrice"}},[o("el-input",{attrs:{placeholder:"属性为'大小'时才要填，其他情况不填或填0",type:"number"},model:{value:e.goodsPropertyFormData.rebasePrice,callback:function(t){e.$set(e.goodsPropertyFormData,"rebasePrice",t)},expression:"goodsPropertyFormData.rebasePrice"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"额外价格(单位: 分)",prop:"realPrice"}},[o("el-input",{attrs:{placeholder:"没有就不填，一般在'加料'的时候填",type:"number"},model:{value:e.goodsPropertyFormData.extraPrice,callback:function(t){e.$set(e.goodsPropertyFormData,"extraPrice",t)},expression:"goodsPropertyFormData.extraPrice"}})],1),e._v(" "),o("el-form-item",[o("el-button",{on:{click:e.resetGoodsPropertyForm}},[e._v("重置")]),e._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:e.handelGoodsPropertyFormConfirm}},[e._v("确定")])],1)],1)],1),e._v(" "),o("div",{staticStyle:{margin:"0px 10px","text-align":"left"}},[o("el-table",{attrs:{data:e.goodsAdmins,stripe:"","row-key":function(e){return e.id},"expand-row-keys":e.expands,"default-sort":{prop:"goodsCategoryName",order:"ascending"}},on:{"expand-change":e.expandSelect}},[o("el-table-column",{attrs:{type:"expand"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-button",{attrs:{size:"mini",type:"primary",round:""},on:{click:function(o){return e.toAddGoodsProperty(t.row.id)}}},[e._v("\n            添加商品属性\n          ")]),e._v(" "),o("el-table",{attrs:{data:t.row.goodsPropertyList,stripe:""}},[o("el-table-column",{attrs:{prop:"category",label:"属性类型",sortable:""}}),e._v(" "),o("el-table-column",{attrs:{prop:"propertyOption",label:"属性值"}}),e._v(" "),o("el-table-column",{attrs:{prop:"isDefault",label:"是否为默认属性",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-switch",{attrs:{"active-color":"green","inactive-color":"red",disabled:t.row.isDefault||"加料"===t.row.category},on:{change:function(o){return e.setDefaultPropertyOfGoods(o,t.row)}},model:{value:t.row.isDefault,callback:function(o){e.$set(t.row,"isDefault",o)},expression:"goodsPropertyScope.row.isDefault"}})]}}],null,!0)}),e._v(" "),o("el-table-column",{attrs:{prop:"rebasePrice",label:"商品默认价格",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                "+e._s(t.row.rebasePrice?"￥"+t.row.rebasePrice/100:"无")+"\n              ")]}}],null,!0)}),e._v(" "),o("el-table-column",{attrs:{prop:"extraPrice",label:"额外价格",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                "+e._s(t.row.extraPrice?"￥"+t.row.extraPrice/100:"无")+"\n              ")]}}],null,!0)}),e._v(" "),o("el-table-column",{attrs:{label:"操作",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-edit",circle:""},on:{click:function(o){return e.toEditGoodsProperty(t.row)}}}),e._v(" "),o("el-button",{attrs:{type:"danger",size:"mini",icon:"el-icon-delete",circle:""},on:{click:function(o){return e.deleteGoodsProperty(t.row)}}})]}}],null,!0)})],1)]}}])}),e._v(" "),o("el-table-column",{attrs:{prop:"name",label:"商品名称",sortable:""}}),e._v(" "),o("el-table-column",{attrs:{prop:"goodsCategoryName",label:"商品种类",sortable:""}}),e._v(" "),o("el-table-column",{attrs:{prop:"displayOrder",label:"显示顺序",sortable:""}}),e._v(" "),o("el-table-column",{attrs:{prop:"defaultPrice",label:"默认价格",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n          "+e._s("￥"+t.row.defaultPrice/100)+"\n        ")]}}])}),e._v(" "),o("el-table-column",{attrs:{prop:"image",label:"商品图片"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-upload",{attrs:{action:e.fileUploadUrl+"?goodsId="+t.row.id+"&token="+e.$store.getters.token,"show-file-list":!1,"on-success":e.handleAvatarSuccess,"before-upload":e.beforeAvatarUpload}},[t.row.image?o("img",{staticStyle:{width:"60px",height:"60px"},attrs:{src:e.goodsImageBaseUrl+t.row.image,alt:"商品图片"}}):o("div",{staticStyle:{border:"1px solid lightgray",color:"lightgray"}},[e._v("+上传图片")])])]}}])}),e._v(" "),o("el-table-column",{attrs:{prop:"description",label:"商品描述"}}),e._v(" "),o("el-table-column",{attrs:{label:"是否上架"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-switch",{attrs:{"active-color":"green","inactive-color":"red"},on:{change:function(o){return e.commitStatusChange(o,t.row)}},model:{value:t.row.isSell,callback:function(o){e.$set(t.row,"isSell",o)},expression:"scope.row.isSell"}})]}}])}),e._v(" "),o("el-table-column",{attrs:{label:"操作",width:"130"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(o){return e.toEdit(t.row)}}},[e._v("编辑")]),e._v(" "),o("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(o){return e.toDelete(t.row.id)}}},[e._v("删除")])]}}])})],1),e._v(" "),o("el-row",{staticStyle:{float:"right"}},[o("el-pagination",{attrs:{"current-page":e.searchParams.pageNo,"page-sizes":[5,10,20,30,50,100],"page-size":e.searchParams.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"current-change":e.changePageNo,"size-change":e.changePageSize,"update:currentPage":function(t){return e.$set(e.searchParams,"pageNo",t)},"update:current-page":function(t){return e.$set(e.searchParams,"pageNo",t)},"update:pageSize":function(t){return e.$set(e.searchParams,"pageSize",t)},"update:page-size":function(t){return e.$set(e.searchParams,"pageSize",t)}}})],1)],1)],1)},staticRenderFns:[]},d=o("VU/8")(l,n,!1,null,null,null);t.default=d.exports},DSoa:function(e,t,o){"use strict";t.c=function(){return Object(r.a)({url:"/goodsCategoryAdmin/list",method:"get"})},t.a=function(e){return Object(r.a)({url:"/goodsCategoryAdmin",method:"post",data:e})},t.d=function(e,t){return Object(r.a)({url:"/goodsCategoryAdmin/"+e,method:"put",data:t})},t.e=function(e){return Object(r.a)({url:"/goodsCategoryAdmin/showStatus/"+e,method:"put"})},t.b=function(e){return Object(r.a)({url:"/goodsCategoryAdmin/"+e,method:"delete"})};var r=o("dca+")}});
//# sourceMappingURL=7.74e6f343f52e10c6595e.js.map