webpackJsonp([2],{Ys75:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=i("mvHQ"),o=i.n(s),r=i("tiJG"),n=[{title:"应用管理",permission:"system:app",children:[{title:"用户管理",permission:"system:app:user"},{title:"商品管理",permission:"system:app:goods",children:[{title:"添加商品",permission:"system:app:goods:add"},{title:"修改商品",permission:"system:app:goods:update"}]},{title:"商品种类管理",permission:"system:app:goodsCategory"},{title:"订单管理",permission:"system:app:orderInfo"}]},{title:"系统管理",permission:"system:admin",children:[{title:"系统配置",permission:"system:admin:config"},{title:"定时任务",permission:"system:admin:timingTask"},{title:"管理员管理",permission:"system:admin:sysUser"},{title:"角色管理",permission:"system:admin:role"}]}],l={dialogVisible:!1,data:function(){return{formTitle:"添加角色",dialogVisible:!1,showSetPermissionDialog:!1,roles:[],formData:{name:"",description:""},rules:{name:[{required:!0,message:"请输入角色名称",trigger:"blur"}],description:[]},permissionTree:n,defaultProps:{id:"title",label:"title",children:"children"},permissions:[]}},mounted:function(){this._getAllRoles()},methods:{_getAllRoles:function(){var e=this;Object(r.c)().then(function(t){e.roles=t.data})},toAdd:function(){this.dialogVisible=!0,this.resetForm(),this.formTitle="添加角色"},edit:function(e){this.formData=JSON.parse(o()(e)),this.dialogVisible=!0,this.formTitle="更新角色"},resetForm:function(){this.formData={name:"",description:""}},handelConfirm:function(){var e=this;this.dialogVisible=!1,"添加角色"===this.formTitle?Object(r.a)(this.formData).then(function(){e._getAllRoles()}):Object(r.e)(this.formData).then(function(){e._getAllRoles()})},toSetPermissions:function(e){var t=this;t.resetChecked(),t.formData=JSON.parse(o()(e)),t.showSetPermissionDialog=!0,t.formTitle="更新角色",Object(r.d)(e.id).then(function(e){if(e.data.indexOf("*")>=0){var i=[];t.permissionTree.forEach(function(e){i.push(e.permission)}),t.permissions=i,console.log(i)}else t.permissions=e.data})},resetChecked:function(){this.$refs.permissionTree&&this.$refs.permissionTree.setCheckedKeys([])},setPermissions:function(){var e=this;this.showSetPermissionDialog=!1;var t=[];this.$refs.permissionTree.getCheckedNodes(!1).forEach(function(e){e.permission&&t.push(e.permission)});var i={roleId:this.formData.id,permissions:t};console.log("[设置角色权限] ",i),Object(r.f)(i).then(function(t){e.$notify.success("操作成功")})},delRoles:function(e){var t=this,i=this;this.$confirm("提示","删除角色",{}).then(function(){Object(r.b)([e]).then(function(){t.$notify.success("删除成功"),i._getAllRoles()})}).catch(function(){})}}},a={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticStyle:{"text-align":"left",margin:"5px 10px"}},[i("el-button",{attrs:{size:"mini",type:"primary",round:""},on:{click:e.toAdd}},[e._v("添加")]),e._v(" "),i("el-dialog",{attrs:{title:e.formTitle,visible:e.dialogVisible},on:{"update:visible":function(t){e.dialogVisible=t}}},[i("el-form",{ref:"elForm",attrs:{model:e.formData,rules:e.rules,size:"medium","label-width":"100px"}},[i("el-form-item",{attrs:{label:"角色名称",prop:"name"}},[i("el-input",{style:{width:"100%"},attrs:{placeholder:"请输入角色名称",maxlength:20},model:{value:e.formData.name,callback:function(t){e.$set(e.formData,"name",t)},expression:"formData.name"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"描述"}},[i("el-input",{style:{width:"100%"},attrs:{placeholder:"请输入描述"},model:{value:e.formData.description,callback:function(t){e.$set(e.formData,"description",t)},expression:"formData.description"}})],1),e._v(" "),i("el-form-item",[i("el-button",{on:{click:e.resetForm}},[e._v("重置")]),e._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:e.handelConfirm}},[e._v("确定")])],1)],1)],1),e._v(" "),i("el-dialog",{attrs:{title:"角色授权",visible:e.showSetPermissionDialog},on:{"update:visible":function(t){e.showSetPermissionDialog=t}}},[i("el-form",[i("el-form-item",[i("el-tree",{ref:"permissionTree",attrs:{data:e.permissionTree,"show-checkbox":"","node-key":"permission",props:e.defaultProps,"default-expanded-keys":["system:app"],"default-checked-keys":e.permissions}})],1),e._v(" "),i("el-form-item",[i("el-button",{on:{click:e.resetChecked}},[e._v("清空")]),e._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:e.setPermissions}},[e._v("确定")])],1)],1)],1),e._v(" "),i("div",{staticStyle:{margin:"5px 0px","text-align":"left"}},[i("el-table",{attrs:{data:e.roles,stripe:"","default-sort":{prop:"name",order:"ascending"},"max-height":700}},[i("el-table-column",{attrs:{prop:"name",label:"角色名称",sortable:""}}),e._v(" "),i("el-table-column",{attrs:{prop:"description",label:"描述"}}),e._v(" "),i("el-table-column",{attrs:{label:"操作",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-button",{attrs:{type:"text",size:"small"},on:{click:function(i){return e.toSetPermissions(t.row)}}},[e._v("授权")]),e._v(" "),i("el-button",{attrs:{type:"text",size:"small"},on:{click:function(i){return e.edit(t.row)}}},[e._v("编辑")]),e._v(" "),i("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(i){return e.delRoles(t.row.id)}}},[e._v("删除")])]}}])})],1)],1)],1)},staticRenderFns:[]};var m=i("VU/8")(l,a,!1,function(e){i("kyfL")},null,null);t.default=m.exports},kyfL:function(e,t){},tiJG:function(e,t,i){"use strict";t.c=function(){return Object(s.a)({url:"/role/list",method:"get"})},t.d=function(e){return Object(s.a)({url:"/role/perms/"+e,method:"get"})},t.a=function(e){return Object(s.a)({url:"/role/",method:"post",data:e})},t.e=function(e){return Object(s.a)({url:"/role",method:"put",data:e})},t.b=function(e){return Object(s.a)({url:"/role/batch",method:"delete",data:e})},t.f=function(e){return Object(s.a)({url:"/role/permission",method:"put",data:e})};var s=i("dca+")}});
//# sourceMappingURL=2.a0ca0b3e2e5260f7c468.js.map